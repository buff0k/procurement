{% extends "templates/web.html" %}

{% block page_content %}
<meta name="csrf_token" content="{{ csrf_token }}">
<div id="quotation-container" data-doc="{{ doc.name | e }}">
    <h2>Supplier Quotation:</h2>
    <div>
        <strong>Quotation Status:</strong> <span>{{ doc.status }}</span>
    </div>
    <div>
        <strong>Our Reference Number:</strong> <span>{{ doc.name }}</span>
    </div>
    <div>
        <strong>Your Reference Number:</strong>
        <input id="quotation_number" class="form-control" type="text" placeholder="Enter your own Internal Quotation Number Here" value="{{ doc.quotation_number or '' }}" {% if not doc.has_permission('write') %}readonly{% endif %}>
    </div>
    <div>
        <h3>Form Description:</h3>
        <p>Here you can modify, update, change, save, submit, or delete any quotations, note that once a quotation is submitted, you will not be able to alter or amend it anymore.</p>
        <p>If you delete a draft quotation here, it is not recoverable and you will need to create a new quotation for the specific RFQ</p>
        <p>Editible fields include: Your Reference Number (If you have an internal Quotation Number you can enter that here), Qty (Quantity, the number of units), Unit of Measure (The measurement unit, i.e. hours, months, units, km, etc.), Rate (The Rate per Unit, if Unit of Measure is Hours, then the number of hours quoted on).</p>
        <p>You can also upload attachments such as supporting documents, your formal quotation, etc.</p>
        <span>Note, all prices are Exclusive of Taxes and in:</span> <strong>{{ doc.currency }}</strong>
    </div>
    <h3>Quotation Items</h3>
    <table id="items-table" class="table table-bordered" style="table-layout: fixed; width: 100%;">
        <thead>
            <tr>
                <th style="width: 40%;">Item</th>
                <th style="width: 10%;">Qty</th>
                <th style="width: 20%;">Unit Of Measure</th>
                <th style="width: 15%;">Rate</th>
                <th style="width: 15%;">Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {% for item in doc.items %}
            <tr data-item="{{ item.name }}">
                <td style="word-wrap: break-word; white-space: normal;">{{ item.description }}</td>
                <td><input class="qty" type="number" value="{{ item.qty }}" style="width: 100%;"></td>
                <td>
                    <select class="uom" style="width: 100%;">
                        {% for uom in uoms %}
                            <option value="{{ uom.name }}" {% if uom.name == item.uom %}selected{% endif %}>{{ uom.name }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td><input class="rate" type="number" value="{{ item.rate }}" style="width: 100%;"></td>
                <td class="amount">{{ item.amount }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div id="nett-total-wrapper" style="text-align: right; margin-top: 10px;"></div>
    <h3>Attachments</h3>
    <table id="attachments-table" class="table table-bordered">
        <thead>
            <tr>
                <th>File</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for attachment in custom_attachments %}
            <tr>
                <td><a href="{{ attachment.file_url }}" target="_blank">Download</a></td>
                <td>{{ attachment.description }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- File upload input -->
    {% if doc.status != "Submitted" %}
    <div>
        <label for="new-attachment">Attach New File</label>
        <input type="file" id="new-attachment" />
        <input type="text" id="new-attachment-description" class="form-control mt-2" placeholder="Enter description for the file">
        <button type="button" id="upload-attachment" class="btn btn-success mt-2">Upload</button>
    </div>
    {% endif %}

    <h4>Notes or Comments</h4>
    <textarea id="terms" rows="5" class="form-control">{{ doc.terms | striptags }}</textarea>
    {% if doc.status != "Submitted" %}
    <div class="mt-3">
        <button id="save-quotation" class="btn btn-primary">Save</button>
        <button id="submit-quotation" class="btn btn-success">Submit Quotation</button>
        <button id="delete-quotation" class="btn btn-danger">Delete</button>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block script %}
    <script src="/assets/procurement/js/supplier_quotation_portal.js"></script>
{% endblock %}